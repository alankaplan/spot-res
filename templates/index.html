<!DOCTYPE html>
<html>
<head>
    <title>Spotify Resume</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            background-color: white;
            color: black;
            border: 2px solid #1db954;
            padding: 8px 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        button:active {
            background-color: #1db954;
            color: white;
        }
        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .progress-bar {
            height: 8px;
            background-color: #ccc;
            border-radius: 4px;
            overflow: hidden;
            width: 120px;
        }
        .progress-fill {
            height: 100%;
            background-color: #1db954;
            width: 0%;
            transition: width 0.3s;
        }
        .track-info {
            font-size: 0.9em;
            color: #333;
        }
        #save-status {
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <h2>Spotify Resume</h2>

    <div style="margin-bottom: 15px;">
        <button onclick="savePlayback()">ðŸ’¾ Save Current Playback</button>
    </div>
    <hr>
    <div id="playlists"></div>
    <div id="save-status">Loading...</div>

    <script>
        function loadPlaylists() {
            document.getElementById("save-status").textContent = "Loading...";
            fetch('/playlists')
                .then(res => res.json())
                .then(playlists => {
                    const container = document.getElementById("playlists");
                    container.innerHTML = "";

                    playlists.forEach(pl => {
                        const div = document.createElement("div");
                        div.className = "progress-container";

                        const button = document.createElement("button");
                        button.textContent = `â–¶ ${pl.name}`;
                        button.onclick = () => resumePlaylist(pl.uri);

                        const trackInfo = document.createElement("div");
                        trackInfo.className = "track-info";
                        trackInfo.textContent = pl.track_info;

                        const progressBar = document.createElement("div");
                        progressBar.className = "progress-bar";
                        const progressFill = document.createElement("div");
                        progressFill.className = "progress-fill";
                        progressFill.style.width = pl.progress_pct ? `${pl.progress_pct}%` : "0%";
                        progressBar.appendChild(progressFill);

                        div.appendChild(button);
                        div.appendChild(progressBar);
                        div.appendChild(trackInfo);
                        container.appendChild(div);
                    });

                    document.getElementById("save-status").textContent = "Loaded playlists";
                });
        }

        function resumePlaylist(uri) {
            const buttons = document.querySelectorAll("button");
            buttons.forEach(btn => btn.style.backgroundColor = "white"); // Reset colors

            fetch('/resume', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playlist_uri: uri })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.status || data.error);
                loadPlaylists();
            });

            const button = document.querySelector(`button[onclick='resumePlaylist("${uri}")']`);
            if (button) button.style.backgroundColor = "#1db954";
        }

        function savePlayback() {
            document.getElementById("save-status").textContent = "Saving...";
            fetch('/save')
                .then(res => res.json())
                .then(data => {
                    const now = new Date().toLocaleTimeString();
                    document.getElementById("save-status").textContent = `Saved at ${now}`;
                    loadPlaylists();
                });
        }

        loadPlaylists();
    </script>
</body>
</html>

